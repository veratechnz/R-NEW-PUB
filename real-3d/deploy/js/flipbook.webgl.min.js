/* v 2.9
author http://codecanyon.net/user/zlac/portfolio?ref=zlac
*/
var FLIPBOOK=FLIPBOOK||{};FLIPBOOK.PageWebGL=function(t,e,i,o,s,n){THREE.Object3D.call(this),this.book=t,this.frontTexture=i,this.backTexture=o,this.index=e,this.materialType=n.pageMaterial,this.pW=n.pageWidth,this.pH=n.pageHeight,this.pageShininess=n.pageShininess,this.nfacesw=n.pageSegmentsW,this.nfacesh=n.pageSegmentsH,this.mats=[],this.pageHardness=s,this.pageThickness=s,this.duration=n.pageFlipDuration,this.angle=.25*Math.PI*this.pW/this.pH,this.force=10,this.offset=0,this.to=null,this.mod=null,this.bend=null,this.pivot=null,this.isFlippedLeft=!1,this.isFlippedRight=!0,this.flippingLeft=!1,this.flippingRight=!1,this.zz=2,this.options=n;var h;switch(this.materialType){case"phong":h=new THREE.MeshPhongMaterial({color:15592941,ambient:14540253,specular:16777215,diffuse:16777215,shininess:this.options.pageShininess});break;case"basic":h=new THREE.MeshBasicMaterial({color:15592941})}h.side=THREE.DoubleSide,this.gF=new THREE.PlaneGeometry(this.pW,this.pH,this.nfacesw,this.nfacesh),this.planeF=new THREE.Mesh(this.gF,h),this.planeF.position.x=.5*this.pW,this.planeF.castShadow=!0,this.planeF.receiveShadow=!0,this.add(this.planeF),this.gB=new THREE.PlaneGeometry(this.pW,this.pH,this.nfacesw,this.nfacesh),this.planeB=new THREE.Mesh(this.gB,h),this.planeB.position.x=.5*this.pW,this.planeB.castShadow=!0,this.planeB.receiveShadow=!0,this.add(this.planeB),this.pageFlippedAngle=Math.PI*this.options.pageFlippedAngle/180,this.bendF=new MOD3.Bend(0,0,0),this.bendF.constraint=MOD3.ModConstant.LEFT,this.pH>this.pW&&(this.bendF.switchAxes=!0),this.bendB=new MOD3.Bend(0,0,0),this.bendB.constraint=MOD3.ModConstant.LEFT,this.pH>this.pW&&(this.bendB.switchAxes=!0),this.modF=new MOD3.ModifierStack(new MOD3.LibraryThree,this.planeF),this.modF.addModifier(this.bendF),this.modB=new MOD3.ModifierStack(new MOD3.LibraryThree,this.planeB),this.modB.addModifier(this.bendB)},FLIPBOOK.PageWebGL.prototype=new THREE.Object3D,FLIPBOOK.PageWebGL.prototype.constructor=FLIPBOOK.PageWebGL,FLIPBOOK.PageWebGL.prototype.load=function(){if(!this.loaded){this.loaded=!0;var t,e=this,i=this.book.options,o=i.main,s=e.options.rightToLeft?this.book.pages.length-this.index-1:this.index,n=e.options.rightToLeft?2*s+1:2*s,h=e.options.rightToLeft?2*s:2*s+1;""!=i.pdfUrl?(o.loadPagesFromPdf([n],function(){var t=e.options.pages[n].canvas,i=new THREE.Texture(t);i.minFilter=THREE.LinearFilter,i.magFilter=THREE.LinearFilter,i.needsUpdate=!0,"doubleWithCover"==e.options.pageMode&&e.index>0&&(i.repeat.x=.5,i.offset.x=.5),e.planeF.material=e.createMaterial(e.materialType,i),delete t}),o.loadPagesFromPdf([h],function(){var t=e.options.pages[h].canvas,i=new THREE.Texture(t);i.minFilter=THREE.LinearFilter,i.magFilter=THREE.LinearFilter,i.needsUpdate=!0,e.index<e.book.pages.length-1&&"doubleWithCover"==e.options.pageMode?(i.repeat.x=-.5,i.offset.x=.5):(i.repeat.x=-1,i.offset.x=1),e.planeB.material=e.createMaterial(e.materialType,i),e.planeB.material.side=THREE.BackSide,delete t})):t=THREE.ImageUtils.loadTexture(e.frontTexture,void 0,function(i){i.minFilter=THREE.LinearFilter,i.magFilter=THREE.LinearFilter,i.needsUpdate=!0,"left"==e.options.pages[2*e.index].side?i.repeat.x=.5:"right"==e.options.pages[2*e.index].side&&(i.repeat.x=.5,i.offset.x=.5),e.planeF.material=e.createMaterial(e.materialType,i),t=THREE.ImageUtils.loadTexture(e.backTexture,void 0,function(t){t.minFilter=THREE.LinearFilter,t.magFilter=THREE.LinearFilter,t.needsUpdate=!0,"left"==e.options.pages[2*e.index+1].side?(t.repeat.x=-.5,t.offset.x=.5):"right"==e.options.pages[2*e.index+1].side?(t.repeat.x=-.5,t.offset.x=.5):(t.repeat.x=-1,t.offset.x=1),e.planeB.material=e.createMaterial(e.materialType,t),e.planeB.material.side=THREE.BackSide,e.loaded=!0})})}},FLIPBOOK.PageWebGL.prototype.createMaterial=function(t,e){var i;return"phong"==t?i=new THREE.MeshPhongMaterial({map:e,ambient:14540253,specular:16777215,diffuse:16777215,shininess:this.options.pageShininess}):"basic"==t&&(i=new THREE.MeshBasicMaterial({map:e})),i},FLIPBOOK.PageWebGL.prototype._setAngle=function(t){if(180>=t&&t>=-180){if(t=t/180*Math.PI,this.singlePage&&(t>=90&&(t=90),0>t&&(t-=90),-180>t&&(t=-180),this.index==this.book.pages.length-1))return;0>t&&(t+=Math.PI),this.angle=t,this.positionZ(200),this.dragging=!0,this.rotation.y=-t,this.bendF.force=this.bendB.force=this.isFlippedLeft?1.35*Math.pow(-Math.abs(Math.cos(-t/2)),1)/Math.pow(this.pageHardness,1.5):1.35*Math.pow(Math.abs(Math.sin(-t/2)),1)/Math.pow(this.pageHardness,1.5),this.updateBend()}},FLIPBOOK.PageWebGL.prototype.updateBend=function(){this.modF.apply(),this.modB.apply(),this.gF.computeFaceNormals(),this.gF.computeVertexNormals(!0),this.gB.computeFaceNormals(),this.gB.computeVertexNormals(!0)},FLIPBOOK.PageWebGL.prototype.flipLeft=function(t){if(this.onComplete=t,this.dragging=!1,!this.isFlippedLeft&&!this.flippingLeft&&!this.flippingRight&&this.index==this.book.flippedleft){if(this.duration>0){this.flippingLeft=!0,this.flipping=!0,this.force=0;var e=(1+.5*Math.random())/this.pageHardness,i=.1+.2*Math.random();this.to={angle:this.rotation.y,t:-1,xx:0,thiss:this,force:this.force,offset:this.offset},this.bendIn(-Math.PI,e,i)}else this.rotation.y=-Math.PI,this.flippingLeft=!1,this.isFlippedLeft=!0,this.flippingRight=!1,this.isFlippedRight=!1;this.correctZOrder()}},FLIPBOOK.PageWebGL.prototype.correctZOrder=function(){var t,e=4;for(this.position.z=e/2+1,t=this.index-1;t>=0;t--)this.book.pages[t].position.z=this.book.pages[t+1].position.z-e/2-e/2-1;for(t=this.index+1;t<this.book.pages.length;t++)this.book.pages[t].position.z=this.book.pages[t-1].position.z-e/2-e/2-1},FLIPBOOK.PageWebGL.prototype.flipLeftInstant=function(t){if(this.onComplete=t,this.dragging=!1,!this.isFlippedLeft&&!this.flippingLeft&&!this.flippingRight&&this.index==this.book.flippedleft){this.thiss=this,this.xx=0,this.angle=-Math.PI,this.flippingLeft=!0,this.isFlippedLeft=!1,this.renderFlip(),this.flippingLeft=!1,this.isFlippedLeft=!0,this.flippingRight=!1,this.isFlippedRight=!1;var e=4;this.position.z=e/2+1;for(var i=this.index+1;i<this.book.pages.length;i++)this.book.pages[i].position.z=this.book.pages[i-1].position.z-e/2-e/2-1;if(this.index<this.book.pages.length-1){this.position.z=this.book.pages[this.index+1].position.z;for(var i=this.index-1;i>=0;i--)this.book.pages[i].position.z=this.book.pages[i+1].position.z-e/2-e/2-1}else this.index>0&&(this.book.pages[this.index].position.z=this.book.pages[this.index-1].position.z+e/2+e/2-1);this.flipFinished()}},FLIPBOOK.PageWebGL.prototype.flipRightInstant=function(t){if(this.onComplete=t,this.dragging=!1,!this.isFlippedRight&&!this.flippingRight&&!this.flippingLeft&&this.index==this.book.getNumPages()-this.book.flippedright-1){this.thiss=this,this.xx=0,this.angle=0,this.flippingRight=!0,this.isFlippedRight=!1,this.renderFlip(),this.flippingLeft=!1,this.isFlippedLeft=!1,this.flippingRight=!1,this.isFlippedRight=!0;var e=4;this.position.z=e/2+1;for(var i=this.index-1;i>=0;i--)this.book.pages[i].position.z=this.book.pages[i+1].position.z-e/2-e/2-1;if(this.index>0){this.position.z=this.book.pages[this.index-1].position.z;for(var i=this.index+1;i<this.book.pages.length;i++)this.book.pages[i].position.z=this.book.pages[i-1].position.z-e/2-e/2-1}else this.book.pages.length>1&&(this.position.z=this.book.pages[this.index+1].position.z+e/2+e/2-1);this.flipFinished()}},FLIPBOOK.PageWebGL.prototype.flipRight=function(t){if(this.onComplete=t,this.dragging=!1,!this.isFlippedRight&&!this.flippingRight&&!this.flippingLeft&&this.index==this.book.getNumPages()-this.book.flippedright-1){if(this.duration>0){this.flippingRight=!0,this.flipping=!0,this.force=0,this.to={angle:this.rotation.y,t:-1,xx:0,thiss:this,force:this.force,offset:this.offset};var e=(-1-.5*Math.random())/this.pageHardness,i=.1+.2*Math.random();this.bendIn(0,e,i)}else this.rotation.y=0,this.flippingLeft=!1,this.isFlippedLeft=!1,this.flippingRight=!1,this.isFlippedRight=!0;this.correctZOrder()}},FLIPBOOK.PageWebGL.prototype.bendIn=function(t){this.bendF.force=this.bendB.force=0,this.bendF.offset=this.bendB.offset=0,this.updateBend();var e=2*this.duration*300*Math.pow(Math.abs(this.rotation.y-t)/Math.PI,.5)*Math.pow(this.pageHardness,.25);new TWEEN.Tween(this.to).to({angle:t,xx:1,t:1},e).easing(TWEEN.Easing.Sinusoidal.In).onUpdate(this.renderFlip).onComplete(this.bendOut).start(),this.book.options.main.playFlipSound()},FLIPBOOK.PageWebGL.prototype.bendOut=function(){var t=this.thiss,e=t.duration*Math.pow(Math.abs(t.bendF.force),.5)*1e3;new TWEEN.Tween(t.bendF).to({force:0,offset:1},e).easing(TWEEN.Easing.Sinusoidal.Out).onUpdate(function(){t.bendB.offset=t.bendF.offset,t.bendB.force=t.bendF.force,t.updateBend()}).onComplete(function(){t.flipFinished(t)}).start();var i=4;if(t.flippingLeft)if(t.index<t.book.pages.length-1){t.position.z=t.book.pages[t.index+1].position.z;for(var o=t.index-1;o>=0;o--)t.book.pages[o].position.z=t.book.pages[o+1].position.z-i/2-i/2-1}else t.book.pages.length>1&&(t.book.pages[t.index].position.z=t.book.pages[t.index-1].position.z+i/2+i/2-1);if(t.flippingRight)if(t.index>0){t.position.z=t.book.pages[t.index-1].position.z;for(var o=t.index+1;o<t.book.pages.length;o++)t.book.pages[o].position.z=t.book.pages[o-1].position.z-i/2-i/2-1}else t.book.pages.length>1&&(t.position.z=t.book.pages[t.index+1].position.z+i/2+i/2-1)},FLIPBOOK.PageWebGL.prototype.modApply=function(){this.thiss.bendF.force=this.thiss.bendB.force=this.force,this.thiss.bendF.offset=this.thiss.bendB.offset=this.offset,this.thiss.updateBend()},FLIPBOOK.PageWebGL.prototype.renderFlip=function(){.5*Math.PI;this.thiss.flippingLeft&&0==this.thiss.index&&this.thiss.book.getNumPages()>1?this.thiss.book.centerContainer.position.x=(1-this.xx)*this.thiss.book.centerContainer.position.x:this.thiss.flippingLeft&&this.thiss.index==this.thiss.book.getNumPages()-1?this.thiss.book.centerContainer.position.x=(1-this.xx)*this.thiss.book.centerContainer.position.x+this.xx*this.thiss.book.pageW*.5*this.thiss.book.centerContainer.scale.x:this.thiss.flippingRight&&0==this.thiss.index?this.thiss.book.centerContainer.position.x=(1-this.xx)*this.thiss.book.centerContainer.position.x-this.xx*this.thiss.book.pageW*.5*this.thiss.book.centerContainer.scale.x:this.thiss.flippingRight&&this.thiss.index==this.thiss.book.getNumPages()-1&&(this.thiss.book.centerContainer.position.x=(1-this.xx)*this.thiss.book.centerContainer.position.x*this.thiss.book.centerContainer.scale.x),this.thiss._setAngle(180*-this.angle/Math.PI)},FLIPBOOK.PageWebGL.prototype.flipFinished=function(){var t=this;t.flippingLeft?(t.flippingLeft=!1,t.isFlippedLeft=!0,t.flippingRight=!1,t.isFlippedRight=!1):t.flippingRight&&(t.flippingLeft=!1,t.isFlippedRight=!0,t.flippingRight=!1,t.isFlippedLeft=!1),t.bendF.force=t.bendB.force=0,t.bendF.offset=t.bendB.offset=0,t.updateBend(),t.flipping=!1,t.dragging=!1,"undefined"!=typeof t.onComplete&&t.onComplete(t),t.book.flipFinnished()},FLIPBOOK.PageWebGL.prototype.isFlippedLeft=function(){return this.thiss.isFlippedLeft},FLIPBOOK.PageWebGL.prototype.isFlippedRight=function(){return this.thiss.isFlippedRight},FLIPBOOK.PageWebGL.prototype.positionZ=function(){},FLIPBOOK.BookWebGL=function(t,e){this.elementId=jQuery(e.main.elem).attr("id"),this.wrapper="object"==typeof t?t:document.getElementById(t),this.options=e,this.main=e.main,this.pageW=e.pageWidth,this.pageH=e.pageHeight,this.pageW=1500*e.pageWidth/e.pageHeight,this.pageH=1500,this.main.options.pageWidth=this.pageW,this.main.options.pageHeight=this.pageH,this.scroll=e.scroll,this.pagesArr=e.pagesArr,this.pages=[],this.animating=!1,this.rightIndex=0,this.sc=1;var i=this.wrapper.style;i.width="100%",i.height="100%",i.position="absolute",i.overflow="hidden",(!e.lightBox||e.lightBoxOpened)&&this.enable()},FLIPBOOK.BookWebGL.prototype=new THREE.Object3D,FLIPBOOK.BookWebGL.prototype.constructor=FLIPBOOK.BookWebGL,FLIPBOOK.BookWebGL.prototype.init3d=function(){var t=this,e=30,i=jQuery(t.wrapper).width(),o=jQuery(t.wrapper).height(),s=i/o,n=1,h=1e4,r=this.options;this.Scene=new THREE.Scene,this.centerContainer=new THREE.Object3D,this.Scene.add(this.centerContainer),this.Camera=new THREE.PerspectiveCamera(e,s,n,h),this.Scene.add(this.Camera),this.zoom=r.zoom,this.pan=r.pan,this.tilt=r.tilt,this.updateCameraPosition();{var a=this.wrapper,p=document.createElement("canvas");p.getContext("webgl")}this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),this.renderer.setSize(a.clientWidth,a.clientHeight),a.appendChild(this.renderer.domElement),this.canvas=this.renderer.domElement,this._bind("mousedown",this.canvas),this._bind("mousemove",this.canvas),this._bind("mouseout",this.canvas),this._bind("mouseup",this.canvas),this._bind("touchstart",this.canvas),this._bind("touchmove",this.canvas),this._bind("touchend",this.canvas),this._bind("touchcancel",this.canvas),r.pageShadow&&(t.renderer.shadowMapEnabled=!0);var f=new THREE.AmbientLight(r.ambLightColor);this.Scene.add(f);var d=new THREE.SpotLight(r.spotLightColor);d.intensity=r.spotLightIntensity,d.position.set(r.spotLightX,r.spotLightY,r.spotLightZ),d.position.z=2*r.pageWidth>r.pageHeight?2.4*r.pageWidth:1.2*r.pageHeight,this.Scene.add(d),r.pageShadow&&(d.castShadow=!0,d.shadowDarkness=r.spotLightShadowDarkness,d.shadowMapWidth=1024,d.shadowMapHeight=1024,d.shadowBias=-0.3/d.position.z),this.sl=d,this.centerContainer.position.set(0,0,0),""!=r.backgroundPattern&&r.backgroundPattern||r.lightBox||(this.bg=new THREE.Mesh(new THREE.PlaneBufferGeometry(1e4,1e4),new THREE.MeshBasicMaterial({color:r.backgroundColor})),this.bg.receiveShadow=!0,this.centerContainer.add(this.bg)),this.onResize(),this.centerContainer.position.x=.5*-this.pageW*this.centerContainer.scale.x,this.flippedleft=0,this.flippedright=0,this.cameraZMin=300,this.cameraZMax=5e3,function c(){if(t.rendering){if(!t.enabled)return;TWEEN.update(),t.renderer.render(t.Scene,t.Camera)}requestAnimationFrame(c)}()},FLIPBOOK.BookWebGL.prototype.enablePrev=function(t){this.prevEnabled=t},FLIPBOOK.BookWebGL.prototype.enableNext=function(t){this.nextEnabled=t},FLIPBOOK.BookWebGL.prototype.isZoomed=function(){return this.main.zoom>this.options.zoomLevels[0]&&this.main.zoom>1},FLIPBOOK.BookWebGL.prototype.getRightPage=function(){return this.pages[this.flippedleft]},FLIPBOOK.BookWebGL.prototype.getBelowRightPage=function(){return this.pages[this.flippedleft+1]},FLIPBOOK.BookWebGL.prototype.getLeftPage=function(){return this.pages[this.flippedleft-1]},FLIPBOOK.BookWebGL.prototype.getBelowLeftPage=function(){return this.pages[this.flippedleft-2]},FLIPBOOK.BookWebGL.prototype.onSwipe=function(t,e,i,o,s,n,h){if(!this.isZoomed()){o=h[0].start.x-h[0].end.x;var r=this.getLeftPage(),a=this.getRightPage();if((!this.options.rotateCameraOnMouseDrag||a&&a.dragging||r&&r.dragging||"rotate"!=this.onMouseMove&&"scroll"!=this.onMouseMove)&&("end"==e&&1>=n&&(!(0>o)||a&&a.dragging?!(o>0)||r&&r.dragging?0==o&&(this.clickedPage?this.clickedPage.isFlippedLeft?this.prevPage():this.nextPage():null):this.nextPage():this.prevPage()),"cancel"==e&&1>=n&&(!(0>o)||a&&a.dragging?!(o>0)||r&&r.dragging?0==o&&(this.clickedPage?this.clickedPage.isFlippedLeft?this.prevPage():this.nextPage():null):this.nextPage():this.prevPage()),"move"==e&&1>=n)){if(o=180*(h[0].start.x-h[0].end.x)/jQuery(this.wrapper).width(),r&&r.flipping||a&&a.flipping)return;a&&a.dragging||r&&r.dragging?r&&!a||r&&!a.dragging?0>=o&&r._setAngle(o,i):(a&&!r||a&&!r.dragging)&&o>=0&&a._setAngle(o,i):"right"!=i||!r||a&&a.dragging||!this.prevEnabled?"left"==i&&a&&this.nextEnabled&&(a._setAngle(o,i),a.positionZ(200)):(r._setAngle(o,i),r.positionZ(200))}}},FLIPBOOK.BookWebGL.prototype.onResize=function(){var t=jQuery(this.wrapper).width(),e=jQuery(this.wrapper).height(),i=this.options.pageWidth,o=this.options.pageHeight,s=t/e,n=i/o;this.sc=s>2*n?1:s/(2*n),this.renderer.setSize(t,e),this.Camera.aspect=t/e,this.Camera.updateProjectionMatrix(),this.updateCameraPosition(),this.wrapperW=t,this.wrapperH=e},FLIPBOOK.BookWebGL.prototype.updateCameraPosition=function(){var t=Math.PI*this.tilt/180,e=0,i=this.options.cameraDistance*Math.sin(t)/this.zoom;cameraZ=this.options.cameraDistance*Math.cos(t)/this.zoom,this.centerContainer.scale.set(this.sc,this.sc,this.sc),t=Math.PI*this.pan/180,e=Math.sin(t)*cameraZ,cameraZ=Math.cos(t)*cameraZ,this.cameraZ=cameraZ,this.Camera.position.set(Math.round(e),Math.round(i),Math.round(cameraZ)),this.Camera.lookAt(this.Scene.position)},FLIPBOOK.BookWebGL.prototype.createPages=function(){var t,e,i,o,s,n=this,h=n.pagesArr;for(s=0;s<h.length/2;s++){t=h[2*s].src,e=2*s+1>=h.length?"":h[2*s+1].src,i=0==s||s==h.length/2-1?n.options.coverHardness:n.options.pageHardness,o=new FLIPBOOK.PageWebGL(n,s,t,e,i,n.options),n.pages.push(o),n.centerContainer.add(o),n.flippedright++,n.options.loadAllPages&&o.load();var r=4;s>0?(o.position.z=n.pages[s-1].position.z-r/2-r/2-1,this.bg&&(this.bg.position.z=o.position.z-5)):o.position.z=r/2}n.initialized=!0,n.options.rightToLeft?(n.pages[n.pages.length-1].load(),n.pages.length>1&&n.pages[n.pages.length-2].load()):(n.pages[0].load(),n.pages.length>1&&n.pages[1].load())},FLIPBOOK.BookWebGL.prototype.getNumPages=function(){return this.pages.length},FLIPBOOK.BookWebGL.prototype.centerContainer=function(){return this.centerContainer},FLIPBOOK.BookWebGL.prototype.goToPage=function(t,e){if(!this.initialized){var i=this;return void setTimeout(function(){i.goToPage(t,e)},100)}if(0>t&&(t=0),t>this.options.pages.length&&(t=this.options.pages.length),t%2!=0&&t--,t==this.rightIndex)return void this.options.main.turnPageComplete();this.goingToPage=t;var i=this,o=1e3*this.options.pageFlipDuration/6;if("undefined"!=typeof e&&e){if(t>i.rightIndex)for(;i.rightIndex<t;)this.nextPageInstant();else for(;i.rightIndex>t;)this.prevPageInstant();var s=this.pages[this.flippedleft];s&&s.load();var n=this.pages[this.flippedleft+1];n&&n.load();var h=this.pages[this.flippedleft-1];h&&h.load();var r=this.pages[this.flippedleft-2];return r&&r.load(),this.updateBookPosition(),void this.options.main.turnPageComplete()}this.rightIndex>t?(o=1/(this.rightIndex-t)*this.options.pageFlipDuration*1e3/6,this.rightIndex-t>10&&(o=0),this.rightIndex-2>t?(this.prevPage(!1),o>0?setTimeout(function(){i.goToPage(t,e)},o):i.goToPage(t,e)):(this.prevPage(),setTimeout(function(){if("undefined"!=typeof e&&e)for(var t=0;t<i.pages.length;t++)i.pages[t].duration=i.options.pageFlipDuration;i.options.main.turnPageComplete()},o))):this.rightIndex<t&&(o=-1/(this.rightIndex-t)*this.options.pageFlipDuration*1e3/6,this.rightIndex-t<-10&&(o=0),this.rightIndex+2<t?(this.nextPage(!1),o>0?setTimeout(function(){i.goToPage(t,e)},o):i.goToPage(t,e)):(this.nextPage(),setTimeout(function(){if("undefined"!=typeof e&&e)for(var t=0;t<i.pages.length;t++)i.pages[t].duration=i.options.pageFlipDuration;i.options.main.turnPageComplete()},o)))},FLIPBOOK.BookWebGL.prototype.nextPageInstant=function(){if(0!=this.flippedright){var t;for(t=0;t<this.pages.length;t++)if(this.pages[t].flippingRight)return;var e=this.pages[this.pages.length-this.flippedright];e.flipLeftInstant(),this.flippedleft++,this.flippedright--,this.rightIndex+=2,this.updateBookPosition()}},FLIPBOOK.BookWebGL.prototype.prevPageInstant=function(){if(0!=this.flippedleft){var t;for(t=0;t<this.pages.length;t++)if(this.pages[t].flippingLeft)return;var e=this.pages[this.flippedleft-1];e.flipRightInstant(),this.flippedleft--,this.flippedright++,this.rightIndex-=2,this.updateBookPosition()}},FLIPBOOK.BookWebGL.prototype.nextPage=function(t){if(0!=this.flippedright&&this.nextEnabled&&(this.clickedPage=null,!(1==this.flippedright&&2*this.pages.length>this.pagesArr.length)||this.options.rightToLeft)){var e;for(e=0;e<this.pages.length;e++)if(this.pages[e].flippingRight)return;{var i=this.pages[this.pages.length-this.flippedright];this.pages[this.flippedleft+1],this.pages[this.flippedleft]}if(!i.flipping){var o,s=this;("undefined"==typeof t||t)&&(o=function(){var t=s.pages[s.flippedleft],e=s.pages[s.flippedleft-1],i=s.pages[s.flippedleft-2],o=s.pages[s.flippedleft+1];t&&t.load(),e&&e.load(),i&&i.load(),o&&o.load(),s.main.turnPageComplete()}),i.flipLeft(o)}this.flippedleft++,this.flippedright--,this.rightIndex+=2}},FLIPBOOK.BookWebGL.prototype.updateBookPosition=function(){this.centerContainer.position.x=0==this.rightIndex?.5*-this.options.pageWidth*this.centerContainer.scale.x:this.rightIndex>=this.options.pagesArr.length?.5*this.options.pageWidth*this.centerContainer.scale.x:0},FLIPBOOK.BookWebGL.prototype.prevPage=function(t){if(0!=this.flippedleft&&this.prevEnabled&&(this.clickedPage=null,1!=this.flippedleft||2*this.pages.length!=this.pagesArr.length||!this.options.rightToLeft||!this.options.oddPages)){var e;for(e=0;e<this.pages.length;e++)if(this.pages[e].flippingLeft)return;{var i=this.pages[this.flippedleft-1];this.pages[this.flippedleft-1],this.pages[this.flippedleft-2]}if(!i.flipping){var o,s=this;("undefined"==typeof t||t)&&(o=function(){var t=s.pages[s.flippedleft],e=s.pages[s.flippedleft-1],i=s.pages[s.flippedleft-2],o=s.pages[s.flippedleft+1];t&&t.load(),e&&e.load(),i&&i.load(),o&&o.load(),s.main.turnPageComplete()}),i.flipRight(o)}this.flippedleft--,this.flippedright++,this.rightIndex-=2}},FLIPBOOK.BookWebGL.prototype.firstPage=function(){},FLIPBOOK.BookWebGL.prototype.flipFinnished=function(){},FLIPBOOK.BookWebGL.prototype.lastPage=function(){},FLIPBOOK.BookWebGL.prototype.updateVisiblePages=function(){},FLIPBOOK.BookWebGL.prototype.onZoom=function(){var t=this;setTimeout(function(){for(var e=0;e<t.pages.length;e++)t.pages[e].loaded=!1;var i=t.pages[t.flippedleft],o=t.pages[t.flippedleft-1];i&&i.load(),o&&o.load()},300)},FLIPBOOK.BookWebGL.prototype.render=function(t){var e=this;e.rendering=t},FLIPBOOK.BookWebGL.prototype.zoomTo=function(t,e){"undefined"==typeof e&&(e=200);var i=this;if(newZoom=t>this.options.zoomMax?this.options.zoomMax:t,newZoom=t<this.options.zoomMin?this.options.zoomMin:t,this.zooming=!0,newZoom==this.options.zoom){{this.options}this.centerContainer.position.set(0,0,0),this.updateBookPosition()}e>0?new TWEEN.Tween(this).to({zoom:newZoom},e).easing(TWEEN.Easing.Sinusoidal.InOut).onUpdate(this.updateCameraPosition).onComplete(function(){i.zooming=!1}).start():(this.zoom=newZoom,this.zooming=!1,this.updateCameraPosition()),i.options.parent.onZoom(newZoom)},FLIPBOOK.BookWebGL.prototype.tiltTo=function(t){var e=.3,i=this.tilt+t*e;i=i>this.options.tiltMax?this.options.tiltMax:i,i=i<this.options.tiltMin?this.options.tiltMin:i,this.tilt=i,this.updateCameraPosition()},FLIPBOOK.BookWebGL.prototype.panTo=function(t){var e=.2,i=this.pan-t*e;i=i>this.options.panMax?this.options.panMax:i,i=i<this.options.panMin?this.options.panMin:i,this.pan=i,this.updateCameraPosition()},FLIPBOOK.BookWebGL.prototype._bind=function(t,e,i){(e||this.wrapper).addEventListener(t,this,!!i)},FLIPBOOK.BookWebGL.prototype.handleEvent=function(t){var e=this;switch(t.preventDefault(),t.type){case"mousedown":e._start(t);break;case"touchstart":e._touchstart(t);break;case"touchmove":e._touchmove(t);break;case"mousemove":e._move(t);break;case"mouseout":case"mouseup":case"touchend":e._end(t)}},FLIPBOOK.BookWebGL.prototype.resetCameraPosition=function(){this.centerContainer.position.set(0,0,0)},FLIPBOOK.BookWebGL.prototype._start=function(t){this.mouseDown=!0,this.onMouseMove="",this.pointX=t.pageX,this.pointY=t.pageY,this.startPoint=t;var e=this._getVector(t);e.unproject(this.Camera);var i=new THREE.Raycaster(this.Camera.position,e.sub(this.Camera.position).normalize()),o=i.intersectObjects(this.pages,!0);this.pageMouseDown=o.length>0,!this.pageMouseDown&&this.options.lightBox&&this.options.lightboxCloseOnClick&&this.options.main.lightbox.closeLightbox()},FLIPBOOK.BookWebGL.prototype._touchstart=function(t){if(t.touches.length>1){this.touches=[],this.touches[0]={pageX:t.touches[0].pageX,pageY:t.touches[0].pageY},this.touches[1]={pageX:t.touches[1].pageX,pageY:t.touches[1].pageY};var e=Math.abs(this.touches[0].pageX-this.touches[1].pageX),i=Math.abs(this.touches[0].pageY-this.touches[1].pageY);return void(this.touchesDistStart=Math.sqrt(e*e+i*i))}t=t.touches[0],this._start(t)},FLIPBOOK.BookWebGL.prototype._getVector=function(t){{var e=jQuery(this.canvas).width(),i=jQuery(this.canvas).height(),o=t.pageX-jQuery(this.canvas).offset().left,s=t.pageY-jQuery(this.canvas).offset().top;jQuery(this.canvas).offset().x,jQuery(this.canvas).offset().y}return new THREE.Vector3(o/e*2-1,2*-(s/i)+1,.5)},FLIPBOOK.BookWebGL.prototype._touchmove=function(t){if(t.touches.length>1){this.touches=[],this.touches[0]={pageX:t.touches[0].pageX,pageY:t.touches[0].pageY},this.touches[1]={pageX:t.touches[1].pageX,pageY:t.touches[1].pageY};var e=Math.abs(this.touches[0].pageX-this.touches[1].pageX),i=Math.abs(this.touches[0].pageY-this.touches[1].pageY);return this.touchesDist=Math.sqrt(e*e+i*i),this.zoomTo(this.zoom*Math.pow(this.touchesDist/this.touchesDistStart,.125),0),void this.updateCameraPosition()}t=t.touches[0],this._move(t)},FLIPBOOK.BookWebGL.prototype._move=function(t){var e=this._getVector(t);e.unproject(this.Camera);var i=new THREE.Raycaster(this.Camera.position,e.sub(this.Camera.position).normalize()),o=i.intersectObjects(this.pages,!0),s=t,n=.5*(s.pageX-this.pointX),h=.5*(s.pageY-this.pointY);if(this.pointX=s.pageX,this.pointY=s.pageY,!this.mouseDown)return this.onMouseMove="",void(this.options.rotateCameraOnMouseMove&&(this.tilt=this.options.tiltMin2+(this.options.tiltMax2-this.options.tiltMin2)*(1-this.pointY/jQuery(this.canvas).height()),this.pan=this.options.panMin2+(this.options.panMax2-this.options.panMin2)*this.pointX/jQuery(this.canvas).width(),this.updateCameraPosition()));if(o.length>0?""==this.onMouseMove&&this.zoom>this.options.zoom&&(this.onMouseMove="scroll"):""==this.onMouseMove&&(this.onMouseMove="rotate"),"scroll"==this.onMouseMove)(0!=n||0!=h)&&(this.moved=!0),this.centerContainer.position.x+=22e3*n/(this.cameraZ*this.zoom*this.zoom),this.centerContainer.position.y-=22e3*h/(this.cameraZ*this.zoom*this.zoom);else if("rotate"==this.onMouseMove){var r=this.getRightPage(),a=this.getLeftPage();this.options.rotateCameraOnMouseMove||!this.options.rotateCameraOnMouseDrag||a&&a.dragging||r&&r.dragging||(this.tiltTo(h),this.panTo(n))}},FLIPBOOK.BookWebGL.prototype._end=function(t){this.mouseDown=!1,"undefined"!=typeof t.changedTouches&&(t=t.changedTouches[0]),this.pointX=t.pageX,this.pointY=t.pageY,this.endPoint=t;var e=this._getVector(this.endPoint);e.unproject(this.Camera);var i=new THREE.Raycaster(this.Camera.position,e.sub(this.Camera.position).normalize()),o=i.intersectObjects(this.pages,!0);if(o.length>0&&this.pageMouseDown&&!this.moved){var s=o[0];this.clickedPage=s.object.parent}this.pageMouseDown=!1,this.moved=!1},FLIPBOOK.BookWebGL.prototype.moveCamera=function(){},FLIPBOOK.BookWebGL.prototype.enable=function(){return this.enabled?void this.onResize():(this.enabled=!0,this.initialized||(this.init3d(),this.createPages(),this.rendering=!1,this.onResize()),this.render(!0),void this.onResize())},FLIPBOOK.BookWebGL.prototype.disable=function(){this.enabled=!1,this.render(!1)};var MOD3=MOD3||{};!function(t){t.Constants={PI:Math.PI,invPI:1/Math.PI,halfPI:.5*Math.PI,doublePI:2*Math.PI,toRad:1/180*Math.PI,toDeg:1/180*Math.PI},t.ModConstant={LEFT:-1,RIGHT:1,NONE:0,X:1,Y:2,Z:4}}(MOD3),function(t){var e=t.Constants;t.XMath={},t.XMath.normalize=function(e,i,o){return i-e==0?1:t.XMath.trim(0,1,(o-e)/i)},t.XMath.toRange=function(t,e,i){return e-t==0?0:t+(e-t)*i},t.XMath.inRange=function(t,e,i,o){return"undefined"==typeof o&&(o=!1),o?i>=t&&e>=i:i>t&&e>i},t.XMath.sign=function(t,e){return"undefined"==typeof e&&(e=0),0==t?e:t>0?1:-1},t.XMath.trim=function(t,e,i){return Math.min(e,Math.max(t,i))},t.XMath.wrap=function(t,e,i){return t>i?i+(e-t):i>=e?i-(e-t):i},t.XMath.degToRad=function(t){return t*e.toRad},t.XMath.radToDeg=function(t){return t*e.toDeg},t.XMath.presicion=function(t,e){var i=Math.pow(10,e);return Math.round(t*i)/i},t.XMath.uceil=function(t){return 0>t?Math.floor(t):Math.ceil(t)}}(MOD3),function(t){t.Range=function(t,e){this.start=0,this.end=1,"undefined"!=typeof t&&(this.start=t),"undefined"!=typeof e&&(this.end=e)},t.Range.prototype.getSize=function(){return this.end-this.start},t.Range.prototype.move=function(t){this.start+=t,this.end+=t},t.Range.prototype.isIn=function(t){return t>=this.start&&t<=this.end},t.Range.prototype.normalize=function(e){return t.XMath.normalize(this.start,this.end,e)},t.Range.prototype.toRange=function(e){return t.XMath.toRange(this.start,this.end,e)},t.Range.prototype.trim=function(e){return t.XMath.trim(this.start,this.end,e)},t.Range.prototype.interpolate=function(t,e){return this.toRange(e.normalize(t))},t.Range.prototype.toString=function(){return"["+this.start+" - "+this.end+"]"}}(MOD3),function(t){t.Phase=function(t){this.value=0,"undefined"!=typeof t&&(this.value=t)},t.Phase.prototype.getPhasedValue=function(){return Math.sin(this.value)},t.Phase.prototype.getAbsPhasedValue=function(){return Math.abs(this.getPhasedValue())},t.Phase.prototype.getNormValue=function(){return.5*(this.getPhasedValue()+1)}}(MOD3),function(t){t.Point=function(t,e){this.y=this.x=0,"undefined"!=typeof t&&(this.x=t),"undefined"!=typeof e&&(this.y=e)},t.Point.prototype.clone=function(){return new t.Point(this.x,this.y)}}(MOD3),function(t){t.Matrix=function(t,e,i,o){this.m11=1,this.m21=this.m12=0,this.m22=1,"undefined"!=typeof t&&(this.m11=t),"undefined"!=typeof e&&(this.m12=e),"undefined"!=typeof i&&(this.m21=i),"undefined"!=typeof o&&(this.m22=o)},t.Matrix.prototype.rotate=function(t){var e=Math.cos(t),t=Math.sin(t);return this.m11=e,this.m12=-t,this.m21=t,this.m22=e,this},t.Matrix.prototype.scale=function(t,e){return this.m21=this.m12=0,"undefined"!=typeof t&&(this.m22=this.m11=t),"undefined"!=typeof e&&(this.m22=e),this},t.Matrix.prototype.multiply=function(t){var e=this.m11,i=this.m12,o=this.m21,s=this.m22,n=t.m11,h=t.m12,r=t.m21,t=t.m22;return this.m11=e*n+i*r,this.m12=e*h+i*t,this.m21=o*n+s*r,this.m22=o*h+s*t,this},t.Matrix.prototype.transformPoint=function(e){return new t.Point(this.m11*e.x+this.m12*e.y,this.m21*e.x+this.m22*e.y)}}(MOD3),function(t){t.Vector3=function(t,e,i){this.z=this.y=this.x=null,this.x=t,this.y=e,this.z=i},t.Vector3.ZERO=function(){return new t.Vector3(0,0,0)},t.Vector3.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},t.Vector3.prototype.clone=function(){return new t.Vector3(this.x,this.y,this.z)},t.Vector3.prototype.equals=function(t){return this.x==t.x&&this.y==t.y&&this.z==t.z},t.Vector3.prototype.zero=function(){this.x=this.y=this.z=0},t.Vector3.prototype.negate=function(){return new t.Vector3(-this.x,-this.y,-this.z)},t.Vector3.prototype.add=function(e){return new t.Vector3(this.x+e.x,this.y+e.y,this.z+e.z)},t.Vector3.prototype.subtract=function(e){return new t.Vector3(this.x-e.x,this.y-e.y,this.z-e.z)},t.Vector3.prototype.multiplyScalar=function(e){return new t.Vector3(this.x*e,this.y*e,this.z*e)},t.Vector3.prototype.multiply=function(e){return new t.Vector3(this.x*e.x,this.y*e.y,this.z*e.z)},t.Vector3.prototype.divide=function(e){return e=1/e,new t.Vector3(this.x*e,this.y*e,this.z*e)},t.Vector3.prototype.normalize=function(){var t=this.x,e=this.y,i=this.z,t=t*t+e*e+i*i;t>0&&(t=1/Math.sqrt(t),this.x*=t,this.y*=t,this.z*=t)},t.Vector3.prototype.getMagnitude=function(){var t=this.x,e=this.y,i=this.z;return Math.sqrt(t*t+e*e+i*i)},t.Vector3.prototype.setMagnitude=function(t){this.normalize(),this.x*=t,this.y*=t,this.z*=t},t.Vector3.prototype.toString=function(){return"["+this.x+" , "+this.y+" , "+this.z+"]"},t.Vector3.prototype.sum=function(t,e){return t.add(e)},t.Vector3.prototype.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},t.Vector3.prototype.cross=function(e,i){var o=e.x,s=e.y,n=e.z,h=i.x,r=i.y,a=i.z;return new t.Vector3(s*a-n*r,n*h-o*a,o*r-s*h)},t.Vector3.prototype.distance=function(t,e){var i=t.x-e.x,o=t.y-e.y,s=t.z-e.z;return Math.sqrt(i*i+o*o+s*s)}}(MOD3),function(t){t.Matrix4=function(t,e,i,o,s,n,h,r,a,p,f,d,c,g,u,l){this.n11=1,this.n21=this.n14=this.n13=this.n12=0,this.n22=1,this.n32=this.n31=this.n24=this.n23=0,this.n33=1,this.n43=this.n42=this.n41=this.n34=0,this.n44=1,"undefined"!=typeof t&&(this.n11=t),"undefined"!=typeof e&&(this.n12=e),"undefined"!=typeof i&&(this.n13=i),"undefined"!=typeof o&&(this.n14=o),"undefined"!=typeof s&&(this.n21=s),"undefined"!=typeof n&&(this.n22=n),"undefined"!=typeof h&&(this.n23=h),"undefined"!=typeof r&&(this.n24=r),"undefined"!=typeof a&&(this.n31=a),"undefined"!=typeof p&&(this.n32=p),"undefined"!=typeof f&&(this.n33=f),"undefined"!=typeof d&&(this.n34=d),"undefined"!=typeof c&&(this.n41=c),"undefined"!=typeof g&&(this.n42=g),"undefined"!=typeof u&&(this.n43=u),"undefined"!=typeof l&&(this.n44=l)
},t.Matrix4.prototype.translationMatrix=function(t,e,i){return this.n14=t,this.n24=e,this.n34=i,this},t.Matrix4.prototype.scaleMatrix=function(t,e,i){return this.n11=t,this.n22=e,this.n33=i,this},t.Matrix4.prototype.rotationMatrix=function(t,e,i,o){var s=Math.cos(o),n=Math.sin(o),o=1-s,h=t*e*o,r=e*i*o,a=t*i*o,p=n*i,f=n*e;return n*=t,this.n11=s+t*t*o,this.n12=-p+h,this.n13=f+a,this.n14=0,this.n21=p+h,this.n22=s+e*e*o,this.n23=-n+r,this.n24=0,this.n31=-f+a,this.n32=n+r,this.n33=s+i*i*o,this.n34=0,this},t.Matrix4.prototype.calculateMultiply=function(t,e){var i=t.n11,o=e.n11,s=t.n21,n=e.n21,h=t.n31,r=e.n31,a=t.n12,p=e.n12,f=t.n22,d=e.n22,c=t.n32,g=e.n32,u=t.n13,l=e.n13,y=t.n23,x=e.n23,m=t.n33,M=e.n33,P=t.n14,b=e.n14,v=t.n24,L=e.n24,w=t.n34,O=e.n34;this.n11=i*o+a*n+u*r,this.n12=i*p+a*d+u*g,this.n13=i*l+a*x+u*M,this.n14=i*b+a*L+u*O+P,this.n21=s*o+f*n+y*r,this.n22=s*p+f*d+y*g,this.n23=s*l+f*x+y*M,this.n24=s*b+f*L+y*O+v,this.n31=h*o+c*n+m*r,this.n32=h*p+c*d+m*g,this.n33=h*l+c*x+m*M,this.n34=h*b+c*L+m*O+w},t.Matrix4.prototype.multiply=function(t,e){return this.calculateMultiply(t,e),this},t.Matrix4.prototype.multiplyVector=function(t,e){var i=e.x,o=e.y,s=e.z;e.x=i*t.n11+o*t.n12+s*t.n13+t.n14,e.y=i*t.n21+o*t.n22+s*t.n23+t.n24,e.z=i*t.n31+o*t.n32+s*t.n33+t.n34}}(MOD3),function(t){t.VertexProxy=function(t){this.originalZ=this.originalY=this.originalX=this.ratioZ=this.ratioY=this.ratioX=null,"undefined"!=typeof t&&(this.vertex=t)},t.VertexProxy.prototype.setVertex=function(){},t.VertexProxy.prototype.setRatios=function(t,e,i){this.ratioX=t,this.ratioY=e,this.ratioZ=i},t.VertexProxy.prototype.setOriginalPosition=function(t,e,i){this.originalX=t,this.originalY=e,this.originalZ=i},t.VertexProxy.prototype.getX=function(){},t.VertexProxy.prototype.getY=function(){},t.VertexProxy.prototype.getZ=function(){},t.VertexProxy.prototype.setX=function(){},t.VertexProxy.prototype.setY=function(){},t.VertexProxy.prototype.setZ=function(){},t.VertexProxy.prototype.getValue=function(e){switch(e){case t.ModConstant.X:return this.getX();case t.ModConstant.Y:return this.getY();case t.ModConstant.Z:return this.getZ()}return 0},t.VertexProxy.prototype.setValue=function(e,i){switch(e){case t.ModConstant.X:this.setX(i);break;case t.ModConstant.Y:this.setY(i);break;case t.ModConstant.Z:this.setZ(i)}},t.VertexProxy.prototype.getRatio=function(e){switch(e){case t.ModConstant.X:return this.ratioX;case t.ModConstant.Y:return this.ratioY;case t.ModConstant.Z:return this.ratioZ}return-1},t.VertexProxy.prototype.getOriginalValue=function(e){switch(e){case t.ModConstant.X:return this.originalX;case t.ModConstant.Y:return this.originalY;case t.ModConstant.Z:return this.originalZ}return 0},t.VertexProxy.prototype.reset=function(){this.setX(this.originalX),this.setY(this.originalY),this.setZ(this.originalZ)},t.VertexProxy.prototype.collapse=function(){this.originalX=this.getX(),this.originalY=this.getY(),this.originalZ=this.getZ()},t.VertexProxy.prototype.getVector=function(){return new t.Vector3(this.getX(),this.getY(),this.getZ())},t.VertexProxy.prototype.setVector=function(t){this.setX(t.x),this.setY(t.y),this.setZ(t.z)},t.VertexProxy.prototype.getRatioVector=function(){return new t.Vector3(this.ratioX,this.ratioY,this.ratioZ)}}(MOD3),function(t){t.FaceProxy=function(){this.vertices=[]},t.FaceProxy.prototype.addVertex=function(t){this.vertices.push(t)},t.FaceProxy.prototype.getVertices=function(){return this.vertices}}(MOD3),function(t){t.MeshProxy=function(){this.depth=this.height=this.width=this.minAxis=this.midAxis=this.maxAxis=this.minZ=this.minY=this.minX=this.maxZ=this.maxY=this.maxX=null,this.vertices=[],this.faces=[],this.mesh=null},t.MeshProxy.prototype.getVertices=function(){return this.vertices},t.MeshProxy.prototype.getFaces=function(){return this.faces},t.MeshProxy.prototype.analyzeGeometry=function(){for(var e,i,o,s,n,h,r,a,p,f,d=this.getVertices(),c=d.length,g=c,u=!0,l=Math.min,y=Math.max;--g>=0;)e=d[g],i=e.getX(),o=e.getY(),s=e.getZ(),u?(n=h=i,r=a=o,p=f=s,u=!1):(n=l(n,i),r=l(r,o),p=l(p,s),h=y(h,i),a=y(a,o),f=y(f,s)),e.setOriginalPosition(i,o,s);for(i=h-n,o=a-r,depth=f-p,this.width=i,this.height=o,this.depth=depth,this.minX=n,this.maxX=h,this.minY=r,this.maxY=a,this.minZ=p,this.maxZ=f,g=y(i,y(o,depth)),l=l(i,l(o,depth)),g==i&&l==o?(this.minAxis=t.ModConstant.Y,this.midAxis=t.ModConstant.Z,this.maxAxis=t.ModConstant.X):g==i&&l==depth?(this.minAxis=t.ModConstant.Z,this.midAxis=t.ModConstant.Y,this.maxAxis=t.ModConstant.X):g==o&&l==i?(this.minAxis=t.ModConstant.X,this.midAxis=t.ModConstant.Z,this.maxAxis=t.ModConstant.Y):g==o&&l==depth?(this.minAxis=t.ModConstant.Z,this.midAxis=t.ModConstant.X,this.maxAxis=t.ModConstant.Y):g==depth&&l==i?(this.minAxis=t.ModConstant.X,this.midAxis=t.ModConstant.Y,this.maxAxis=t.ModConstant.Z):g==depth&&l==o&&(this.minAxis=t.ModConstant.Y,this.midAxis=t.ModConstant.X,this.maxAxis=t.ModConstant.Z),g=c;--g>=0;)e=d[g],e.setRatios((e.getX()-n)/i,(e.getY()-r)/o,(e.getZ()-p)/depth)},t.MeshProxy.prototype.resetGeometry=function(){for(var t=this.getVertices(),e=t.length;--e>=0;)t[e].reset()},t.MeshProxy.prototype.collapseGeometry=function(){for(var t=this.getVertices(),e=t.length;--e>=0;)t[e].collapse();this.analyzeGeometry()},t.MeshProxy.prototype.getMin=function(e){switch(e){case t.ModConstant.X:return this.minX;case t.ModConstant.Y:return this.minY;case t.ModConstant.Z:return this.minZ}return-1},t.MeshProxy.prototype.getMax=function(e){switch(e){case t.ModConstant.X:return this.maxX;case t.ModConstant.Y:return this.maxY;case t.ModConstant.Z:return this.maxZ}return-1},t.MeshProxy.prototype.getSize=function(e){switch(e){case t.ModConstant.X:return this.width;case t.ModConstant.Y:return this.height;case t.ModConstant.Z:return this.depth}return-1},t.MeshProxy.prototype.setMesh=function(t){this.mesh=t,this.vertices=[],this.faces=[]},t.MeshProxy.prototype.postApply=function(){},t.MeshProxy.prototype.updateMeshPosition=function(){}}(MOD3),function(t){t.Modifier=function(){this.mod=null},t.Modifier.prototype.setModifiable=function(t){this.mod=t},t.Modifier.prototype.getVertices=function(){return this.mod.getVertices()},t.Modifier.prototype.apply=function(){}}(MOD3),function(t){t.Library3d=function(){this.id="",this.vertexClass=this.meshClass=null}}(MOD3),function(t){t.PluginFactory={},t.PluginFactory.getMeshProxy=function(t){return new t.meshClass}}(MOD3),function(t){t.ModifierStack=function(e,i){this.lib3d=e,this.stack=this.baseMesh=null,this.baseMesh=t.PluginFactory.getMeshProxy(e),this.baseMesh.setMesh(i),this.baseMesh.analyzeGeometry(),this.stack=[]},t.ModifierStack.prototype.addModifier=function(t){t.setModifiable(this.baseMesh),this.stack.push(t)},t.ModifierStack.prototype.apply=function(){this.baseMesh.resetGeometry();for(var t=this.stack,e=t.length,i=0;e>i;)t[i++].apply();this.baseMesh.postApply()},t.ModifierStack.prototype.collapse=function(){this.apply(),this.baseMesh.collapseGeometry(),this.stack=[]},t.ModifierStack.prototype.clear=function(){this.stack=[]},t.ModifierStack.prototype.getMeshInfo=function(){return this.baseMesh}}(MOD3),function(t){t.Pivot=function(e,i,o){this.pivot=new t.Vector3(e,i,o)},t.Pivot.prototype=new t.Modifier,t.Pivot.prototype.constructor=t.Pivot,t.Pivot.prototype.setMeshCenter=function(){var e=this.mod;this.pivot=new t.Vector3(-(e.minX+.5*e.width),-(e.minY+.5*e.height),-(e.minZ+.5*e.depth))},t.Pivot.prototype.apply=function(){for(var t,e,i=this.mod.getVertices(),o=i.length,s=this.pivot;--o>=0;)t=i[o],e=t.getVector().clone(),t.setVector(e.add(s));this.mod.updateMeshPosition(s.clone().negate())}}(MOD3),function(t){t.Bend=function(e,i,o){this.diagAngle=this.angle=this.offset=this.force=null,this.constraint=t.ModConstant.NONE,this.m2=this.m1=this.origin=this.height=this.width=this.mid=this.min=this.max=null,this.switchAxes=!1,this.force=e,this.offset=i,this.setAngle(o)},t.Bend.prototype=new t.Modifier,t.Bend.prototype.constructor=t.Bend,t.Bend.prototype.setAngle=function(e){this.angle=e,this.m1=new t.Matrix,this.m1.rotate(e),this.m2=new t.Matrix,this.m2.rotate(-e)},t.Bend.prototype.setModifiable=function(e){t.Modifier.prototype.setModifiable.call(this,e),this.max=this.switchAxes?this.mod.midAxis:this.mod.maxAxis,this.min=this.mod.minAxis,this.mid=this.switchAxes?this.mod.maxAxis:this.mod.midAxis,this.width=this.mod.getSize(this.max),this.height=this.mod.getSize(this.mid),this.origin=this.mod.getMin(this.max),this.diagAngle=Math.atan(this.width/this.height)},t.Bend.prototype.apply=function(){if(0!=this.force)for(var e,i,o,s,n=this.mod.getVertices(),h=n.length,r=this.width,a=this.offset,p=this.origin,f=this.max,d=this.min,c=this.mid,g=this.m1,u=this.m2,l=p+r*a,y=r/Math.PI/this.force,x=t.Constants.doublePI*(r/(y*t.Constants.doublePI)),m=1/r,M=t.Constants.halfPI,P=Math.sin,b=Math.cos;--h>=0;)r=n[h],e=r.getValue(f),i=r.getValue(c),o=r.getValue(d),i=g.transformPoint(new t.Point(e,i)),e=i.x,i=i.y,s=(e-p)*m,this.constraint==t.ModConstant.LEFT&&a>=s||this.constraint==t.ModConstant.RIGHT&&s>=a||(s=M-x*a+x*s,e=P(s)*(y+o),s=b(s)*(y+o),o=e-y,e=l-s),i=u.transformPoint(new t.Point(e,i)),e=i.x,i=i.y,r.setValue(f,e),r.setValue(c,i),r.setValue(d,o)}}(MOD3),function(t){t.Bloat=function(){this.center=t.Vector3.ZERO(),this.radius=0,this.a=.01,this.u=t.Vector3.ZERO()},t.Bloat.prototype=new t.Modifier,t.Bloat.prototype.constructor=t.Bloat,t.Bloat.prototype.setRadius=function(t){this.radius=Math.max(0,t)},t.Bloat.prototype.setA=function(t){this.a=Math.max(0,t)},t.Bloat.prototype.apply=function(){for(var t,e,i=this.mod.getVertices(),o=i.length,s=this.center,n=this.radius,h=this.a;--o>=0;)t=i[o],this.u.x=t.getX()-s.x,this.u.y=t.getY()-s.y,this.u.z=t.getZ()-s.z,e=this.u.getMagnitude(),this.u.setMagnitude(e+n*Math.exp(-e*h)),t.setX(this.u.x+s.x),t.setY(this.u.y+s.y),t.setZ(this.u.z+s.z)}}(MOD3),function(t){t.Twist=function(e){this.vector=new t.Vector3(0,1,0),this.angle=e,this.center=t.Vector3.ZERO()},t.Twist.prototype=new t.Modifier,t.Twist.prototype.constructor=t.Twist,t.Twist.prototype.apply=function(){this.vector.normalize();for(var e,i=this.mod,o=i.getVertices(),s=o.length,n=this.vector,h=this.angle,r=this.center,i=1/new t.Vector3(.5*i.maxX,.5*i.maxY,.5*i.maxZ).getMagnitude()*h,r=-t.Vector3.dot(n,r);--s>=0;)h=o[s],e=h.getX()*n.x+h.getY()*n.y+h.getZ()*n.z+r,this.twistPoint(h,e*i)},t.Twist.prototype.twistPoint=function(e,i){var o=(new t.Matrix4).translationMatrix(e.getX(),e.getY(),e.getZ()),o=(new t.Matrix4).multiply((new t.Matrix4).rotationMatrix(this.vector.x,this.vector.y,this.vector.z,i),o);e.setX(o.n14),e.setY(o.n24),e.setZ(o.n34)}}(MOD3),function(t){t.Skew=function(e){this.force=0,this.skewAxis=null,"undefined"!=typeof e&&(this.force=e),this.offset=.5,this.constraint=t.ModConstant.NONE,this.falloff=this.power=1,this.swapAxes=this.oneSide=this.inverseFalloff=!1},t.Skew.prototype=new t.Modifier,t.Skew.prototype.constructor=t.Skew,t.Skew.prototype.setModifiable=function(e){t.Modifier.prototype.setModifiable.call(this,e),this.skewAxis=this.skewAxis||this.mod.maxAxis},t.Skew.prototype.apply=function(){for(var e,i,o,s=this.mod.getVertices(),n=s.length,h=this.constraint,r=this.skewAxis,a=this.offset,p=this.oneSide,f=this.inverseFalloff,d=this.falloff,c=1-d,g=this.power,u=this.force,l=this.getDisplaceAxis();--n>=0;)e=s[n],!(h==t.ModConstant.LEFT&&e.getRatio(r)<=a||h==t.ModConstant.RIGHT&&e.getRatio(r)>a||(i=e.getRatio(r)-a,p&&(i=Math.abs(i)),o=e.getRatio(l),f&&(o=1-o),o=d+o*c,i=Math.pow(Math.abs(i),g)*t.XMath.sign(i,1),i=e.getValue(l)+u*i*o,!e.setValue(l,i)))},t.Skew.prototype.getDisplaceAxis=function(){switch(this.skewAxis){case t.ModConstant.X:return this.swapAxes?t.ModConstant.Z:t.ModConstant.Y;case t.ModConstant.Y:return this.swapAxes?t.ModConstant.Z:t.ModConstant.X;case t.ModConstant.Z:return this.swapAxes?t.ModConstant.Y:t.ModConstant.X;default:return 0}}}(MOD3),function(t){t.Taper=function(e){this.power=this.force=null,this.start=0,this.end=1,this.vector=new t.Vector3(1,0,1),this.vector2=new t.Vector3(0,1,0),"undefined"!=typeof e&&(this.force=e),this.power=1},t.Taper.prototype=new t.Modifier,t.Taper.prototype.constructor=t.Taper,t.Taper.prototype.setFalloff=function(t,e){this.start=0,this.end=1,"undefined"!=typeof t&&(this.start=t),"undefined"!=typeof e&&(this.end=e)},t.Taper.prototype.apply=function(){for(var e,i,o,s=this.mod.getVertices(),n=s.length,h=this.vector,r=this.vector2,a=this.force,p=this.power;--n>=0;)e=s[n],i=e.getRatioVector().multiply(r),i=a*Math.pow(i.getMagnitude(),p),i=(new t.Matrix4).scaleMatrix(1+i*h.x,1+i*h.y,1+i*h.z),o=e.getVector(),(new t.Matrix4).multiplyVector(i,o),e.setVector(o)}}(MOD3),function(t){t.Wheel=function(){this.radius=this.roll=this.turn=this.speed=null,this.steerVector=new t.Vector3(0,1,0),this.rollVector=new t.Vector3(0,0,1),this.roll=this.turn=this.speed=0},t.Wheel.prototype=new t.Modifier,t.Wheel.prototype.constructor=t.Wheel,t.Wheel.prototype.setModifiable=function(e){t.Modifier.prototype.setModifiable.call(this,e),this.radius=.5*this.mod.width},t.Wheel.prototype.apply=function(){this.roll+=this.speed;var e,i=this.mod.getVertices(),o=i.length,s=this.steerVector,n=this.turn,h=this.rollVector,r=this.roll;for(0!=n?(e=(new t.Matrix4).rotationMatrix(s.x,s.y,s.z,n),s=h.clone(),(new t.Matrix4).multiplyVector(e,s),r=(new t.Matrix4).rotationMatrix(s.x,s.y,s.z,r)):r=(new t.Matrix4).rotationMatrix(h.x,h.y,h.z,r);--o>=0;)s=i[o],h=s.getVector().clone(),0!=n&&(new t.Matrix4).multiplyVector(e,h),(new t.Matrix4).multiplyVector(r,h),s.setX(h.x),s.setY(h.y),s.setZ(h.z)},t.Wheel.prototype.getStep=function(){return this.radius*this.speed*t.Constants.invPI},t.Wheel.prototype.getPerimeter=function(){return this.radius*t.Constants.doublePI}}(MOD3),function(t){t.Break=function(e,i){this.bv=new t.Vector3(0,1,0),this.angle=this.offset=0,"undefined"!=typeof e&&(this.offset=e),"undefined"!=typeof i&&(this.angle=i),this.range=new t.Range(0,1)},t.Break.prototype=new t.Modifier,t.Break.prototype.constructor=t.Break,t.Break.prototype.apply=function(){var e,i,o=this.mod,s=o.getVertices(),n=s.length,h=this.range,r=this.angle,a=this.bv,o=new t.Vector3(0,0,-(o.minZ+o.depth*this.offset));for(e=o.negate(),i=(new t.Matrix4).rotationMatrix(a.x,a.y,a.z,r);--n>=0;)r=s[n],a=r.getVector(),a=a.add(o),a.z>=0&&h.isIn(r.ratioY)&&(new t.Matrix4).multiplyVector(i,a),a=a.add(e),r.setX(a.x),r.setY(a.y),r.setZ(a.z)}}(MOD3),function(t){t.Noise=function(e){this.force=0,this.axc=t.ModConstant.NONE,this.end=this.start=0,"undefined"!=typeof e&&(this.force=e)},t.Noise.prototype=new t.Modifier,t.Noise.prototype.constructor=t.Noise,t.Noise.prototype.constraintAxes=function(t){this.axc=t},t.Noise.prototype.setFalloff=function(t,e){this.start=0,this.end=1,"undefined"!=typeof t&&(this.start=t),"undefined"!=typeof e&&(this.end=e)},t.Noise.prototype.apply=function(){for(var t,e,i,o=this.mod,s=this.axc,n=this.start,h=this.end,r=o.getVertices(),a=r.length,p=this.force,f=.5*p,d=Math.random;--a>=0;)t=r[a],e=d()*p-f,i=t.getRatio(o.maxAxis),h>n?(n>i&&(i=0),i>h&&(i=1)):n>h?(i=1-i,i>n&&(i=0),h>i&&(i=1)):i=1,1&s||t.setX(t.getX()+e*i),s>>1&1||t.setY(t.getY()+e*i),s>>2&1||t.setZ(t.getZ()+e*i)}}(MOD3),function(t){t.LibraryThree=function(){this.id="Three.js",this.meshClass=t.MeshThree,this.vertexClass=t.VertexThree},t.LibraryThree.prototype=new t.Library3d,t.LibraryThree.prototype.constructor=t.LibraryThree}(MOD3),function(t){t.VertexThree=function(t){this.mesh=t},t.VertexThree.prototype=new t.VertexProxy,t.VertexThree.prototype.setVertex=function(t){this.vertex=t,this.originalX=t.x,this.originalY=t.y,this.originalZ=t.z},t.VertexThree.prototype.getX=function(){return this.vertex.x},t.VertexThree.prototype.getY=function(){return this.vertex.y},t.VertexThree.prototype.getZ=function(){return this.vertex.z},t.VertexThree.prototype.setX=function(t){this.vertex.x=t,t=this.mesh,t.geometry.verticesNeedUpdate=!0,t.geometry.normalsNeedUpdate=!0,t.geometry.buffersNeedUpdate=!0,t.geometry.dynamic=!0},t.VertexThree.prototype.setY=function(t){this.vertex.y=t,t=this.mesh,t.geometry.verticesNeedUpdate=!0,t.geometry.normalsNeedUpdate=!0,t.geometry.buffersNeedUpdate=!0,t.geometry.dynamic=!0},t.VertexThree.prototype.setZ=function(t){this.vertex.z=t,t=this.mesh,t.geometry.verticesNeedUpdate=!0,t.geometry.normalsNeedUpdate=!0,t.geometry.buffersNeedUpdate=!0,t.geometry.dynamic=!0}}(MOD3),function(t){t.MeshThree=function(){},t.MeshThree.prototype=new t.MeshProxy,t.MeshThree.prototype.setMesh=function(e){t.MeshProxy.prototype.setMesh.call(this,e);for(var i,e=[],o=0,s=this.mesh.geometry.vertices,n=s.length,h=this.mesh.geometry.faces,r=h.length,o=0;n>o;)i=new t.VertexThree(this.mesh),i.setVertex(s[o]),this.vertices.push(i),e[s[o]]=i,o++;for(o=0;r>o;)n=new t.FaceProxy,h[o]instanceof THREE.Face3?(n.addVertex(e[s[h[o].a]]),n.addVertex(e[s[h[o].b]]),n.addVertex(e[s[h[o].c]])):h[o]instanceof THREE.Face4&&(n.addVertex(e[s[h[o].a]]),n.addVertex(e[s[h[o].b]]),n.addVertex(e[s[h[o].c]]),n.addVertex(e[s[h[o].d]])),this.faces.push(n),o++;delete lookup},t.MeshThree.prototype.updateMeshPosition=function(t){var e=this.mesh;e.position.x+=t.x,e.position.y+=t.y,e.position.z+=t.z}}(MOD3),function(t){t.LibraryPre3D=function(){this.id="pre3d.js",this.meshClass=t.MeshPre3D,this.vertexClass=t.VertexPre3D},t.LibraryThree.prototype=new t.Library3d,t.LibraryThree.prototype.constructor=t.LibraryPre3D}(MOD3),function(t){t.VertexPre3D=function(){},t.VertexPre3D.prototype=new t.VertexProxy,t.VertexPre3D.prototype.setVertex=function(t){this.vertex=t,this.originalX=t.x,this.originalY=t.y,this.originalZ=t.z},t.VertexPre3D.prototype.getX=function(){return this.vertex.x},t.VertexPre3D.prototype.getY=function(){return this.vertex.y},t.VertexPre3D.prototype.getZ=function(){return this.vertex.z},t.VertexPre3D.prototype.setX=function(t){this.vertex.x=t},t.VertexPre3D.prototype.setY=function(t){this.vertex.y=t},t.VertexPre3D.prototype.setZ=function(t){this.vertex.z=t}}(MOD3),function(t){t.MeshPre3D=function(){},t.MeshPre3D.prototype=new t.MeshProxy,t.MeshPre3D.prototype.setMesh=function(e){t.MeshProxy.prototype.setMesh.call(this,e);for(var e=[],i=this.mesh.vertices,o=this.mesh.quads,s=i.length,n=o.length,h=0;s>h;h++){var r=new t.VertexPre3D;r.setVertex(i[h]),this.vertices.push(r),e[i[h]]=r}for(h=0;n>h;h++)s=new t.FaceProxy,o[h]instanceof Pre3d.QuadFace&&(s.addVertex(e[i[o[h].i0]]),s.addVertex(e[i[o[h].i1]]),s.addVertex(e[i[o[h].i2]]),null!=o[h].i3&&s.addVertex(e[i[o[h].i3]])),this.faces.push(s);delete lookup},t.MeshPre3D.prototype.updateMeshPosition=function(){}}(MOD3),function(t){t.LibraryJ3D=function(){this.id="J3D",this.meshClass=t.MeshJ3D,this.vertexClass=t.VertexJ3D},t.LibraryJ3D.prototype=new t.Library3d,t.LibraryJ3D.prototype.constructor=t.LibraryJ3D}(MOD3),function(t){t.VertexJ3D=function(t){this.geometry=t},t.VertexJ3D.prototype=new t.VertexProxy,t.VertexJ3D.prototype.setVertex=function(t){this.vertex=t;var e=this.geometry;this.originalX=e.vertexPositionBuffer.data[t],this.originalY=e.vertexPositionBuffer.data[t+1],this.originalZ=e.vertexPositionBuffer.data[t+2]},t.VertexJ3D.prototype.getX=function(){return this.geometry.vertexPositionBuffer.data[this.vertex]},t.VertexJ3D.prototype.getY=function(){return this.geometry.vertexPositionBuffer.data[this.vertex+1]},t.VertexJ3D.prototype.getZ=function(){return this.geometry.vertexPositionBuffer.data[this.vertex+2]},t.VertexJ3D.prototype.setX=function(t){var e=this.geometry;e.vertexPositionBuffer.data[this.vertex]=t,e.replaceArray(e.vertexPositionBuffer,e.vertexPositionBuffer.data)},t.VertexJ3D.prototype.setY=function(t){var e=this.geometry;e.vertexPositionBuffer.data[this.vertex+1]=t,e.replaceArray(e.vertexPositionBuffer,e.vertexPositionBuffer.data)},t.VertexJ3D.prototype.setZ=function(t){var e=this.geometry;e.vertexPositionBuffer.data[this.vertex+2]=t,e.replaceArray(e.vertexPositionBuffer,e.vertexPositionBuffer.data)}}(MOD3),function(t){t.MeshJ3D=function(){},t.MeshJ3D.prototype=new t.MeshProxy,t.MeshJ3D.prototype.setMesh=function(e){t.MeshProxy.prototype.setMesh.call(this,e);for(var i,o=0,s=e.geometry.vertexPositionBuffer.data.length,n=e.geometry.vertexPositionBuffer.itemSize,o=0;s>o;)i=new t.VertexJ3D(e.geometry),i.setVertex(o),this.vertices.push(i),o+=n;this.faces=null},t.MeshJ3D.prototype.updateMeshPosition=function(t){var e=this.mesh;e.position.x+=t.x,e.position.y+=t.y,e.position.z+=t.z}}(MOD3),function(t){t.LibraryCopperlicht=function(){this.id="Copperlicht",this.meshClass=t.MeshCopperlicht,this.vertexClass=t.VertexCopperlicht},t.LibraryCopperlicht.prototype=new t.Library3d,t.LibraryCopperlicht.prototype.constructor=t.LibraryCopperlicht}(MOD3),function(t){t.VertexCopperlicht=function(t,e){this.node=t,this.buffer=e},t.VertexCopperlicht.prototype=new t.VertexProxy,t.VertexCopperlicht.prototype.setVertex=function(t){this.vertex=t,this.originalX=this.vertex.Pos.X,this.originalY=this.vertex.Pos.Y,this.originalZ=this.vertex.Pos.Z},t.VertexCopperlicht.prototype.getX=function(){return this.vertex.Pos.X},t.VertexCopperlicht.prototype.getY=function(){return this.vertex.Pos.Y},t.VertexCopperlicht.prototype.getZ=function(){return this.vertex.Pos.Z},t.VertexCopperlicht.prototype.setX=function(t){this.vertex.Pos.X=t,this.buffer.update(!0)},t.VertexCopperlicht.prototype.setY=function(t){this.vertex.Pos.Y=t,this.buffer.update(!0)},t.VertexCopperlicht.prototype.setZ=function(t){this.vertex.Pos.Z=t,this.buffer.update(!0)}}(MOD3),function(t){t.MeshCopperlicht=function(){},t.MeshCopperlicht.prototype=new t.MeshProxy,t.MeshCopperlicht.prototype.setMesh=function(e){t.MeshProxy.prototype.setMesh.call(this,e);for(var e=this.mesh.getMesh().GetMeshBuffers(),i=[],o=0;o<e.length;o++)for(var i=e[o].Vertices,s=i.length,n=0;s>n;n++){var h=new t.VertexCopperlicht(this.mesh,e[o]);h.setVertex(i[n]),this.vertices.push(h)}this.faces=null,delete lookup},t.MeshCopperlicht.prototype.updateMeshPosition=function(t){this.mesh.Pos.X+=t.x,this.mesh.Pos.Y+=t.y,this.mesh.Pos.Z+=t.z}}(MOD3);